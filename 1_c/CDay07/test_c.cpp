// © 什么是野指针？野指针有什么危害？

// 一、野指针的成因
// 1. 未初始化的指针
// c
// int *p;  // 未初始化，指向随机地址
// *p = 10; // 危险！可能覆盖未知内存区域
// 2. 已释放内存的指针
// c
// int *p = malloc(sizeof(int));
// free(p);  // 释放内存后，p仍指向原地址
// *p = 20;  // 危险！操作已释放的内存（野指针）
// 3. 局部变量作用域失效
// c
// int* get_local_ptr() {
//     int x = 5;
//     return &x; // 返回局部变量地址（函数退出后x被销毁）
// }
// int *p = get_local_ptr(); // p成为野指针
// 4. 指针越界操作
// c
// int arr[3] = {1, 2, 3};
// int *p = arr;
// p += 5;  // 越界后指向非法地址（野指针）
// 二、野指针的危害
// 1. 数据损坏
// 野指针可能覆盖其他程序或数据占用的内存，导致数据不一致。

// 示例：

// c
// int *p; // 未初始化
// *p = 100; // 可能修改关键系统内存
// 2. 程序崩溃
// 访问受保护的内存区域（如操作系统保留地址）会触发 段错误（Segmentation Fault）。

// 示例：

// c
// int *p = NULL;
// *p = 10; // 解引用空指针导致崩溃
// 3. 安全漏洞
// 攻击者可利用野指针注入恶意代码（如通过缓冲区溢出）。

// 示例：

// c
// char *buffer = malloc(10);
// free(buffer);
// strcpy(buffer, "恶意数据"); // 可能覆盖敏感区域
// 4. 调试困难
// 野指针引发的问题具有随机性，可能仅在特定条件下复现，增加调试难度。

// 三、规避野指针的实践方法
// 1. 初始化指针为 NULL
// c
// int *p = NULL; // 初始化为空
// if (p != NULL) {
//     *p = 10; // 安全使用前检查
// }
// 2. 释放内存后置空指针
// c
// int *p = malloc(sizeof(int));
// free(p);
// p = NULL; // 避免成为野指针
// 3. 避免返回局部变量地址
// c
// // 错误示范
// int* create_array() {
//     int arr[5];
//     return arr; // arr在函数返回后失效
// }
// // 正确做法：使用动态内存
// int* create_array() {
//     int *arr = malloc(5 * sizeof(int));
//     return arr;
// }
// 4. 使用静态分析工具
// 工具如 Valgrind、AddressSanitizer 可检测野指针和内存泄漏。

// 5. 限制指针作用域
// c
// {
//     int *p = malloc(sizeof(int));
//     // 在限定作用域内使用p
//     free(p);
//     p = NULL;
// } // p超出作用域后无法被误用